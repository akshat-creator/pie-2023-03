<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Software Design</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary fixed-top" data-bs-theme="dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">cam-track</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="team.html">About Us</a>
            </li>
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Product Details
              </a>
              <ul class="dropdown-menu">
                <li style="margin-left:0px"><a class="dropdown-item" href="mechanical.html">Mechanical Design</a></li>
                <li style="margin-left:0px"><a class="dropdown-item" href="electrical.html">Electrical & Firmware Design</a></li>
                <li style="margin-left:0px"><a class="dropdown-item" href="software.html">Software Design</a></li>
                <li><hr class="dropdown-divider"></li>
                <li style="margin-left:0px"><a class="dropdown-item" href="budget.html">Bill of Materials</a></li>
              </ul>
            </li>

            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Sprints
              </a>
              <ul class="dropdown-menu">
                <li style="margin-left:0px"><a class="dropdown-item" href="sprint_1.html">Sprint 1</a></li>
                <li style="margin-left:0px"><a class="dropdown-item" href="sprint_2.html">Sprint 2</a></li>
                <li style="margin-left:0px"><a class="dropdown-item" href="sprint_3.html">Sprint 3</a></li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="gallery.html">Gallery</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container sec-title">
      <div class="card mx-auto img-fluid section-card" style="background-color: gray;">
          <h1 class="card-text" style="color:white; font-size: 50px;">Software Design</h1>
      </div>
    </div>

    <div class="overview">
      <h4>Object Detection</h4>
      <br>
      <div class="row">
        <div class="col">
          <img src="assets/sprint_2_detect.gif" style="width: 80%">
        </div>
        <div class="col-7">
          <p>The gif to the left represents the person detection step of our software. A Single-Shot Multibox Detection
            Deep Neural Network detects the person and returns the following:
          </p>
          <li>Bounding Box</li>
          <li>Confidence Value</li>
          <li>Object ID</li>
          <p>While this does a great job at detecting the subject, performance is too low for our project's purposes.</p>
        </div>
      </div>
    </div>

    <div class="overview">
      <h4>Object Tracking</h4>
      <br>
      <div class="row">
        <div class="col">
          <img src="assets/sprint_3_detect.gif" style="width: 100%">
        </div>
        <div class="col-6">
          <p>To resolve this, we also initiate a tracking step, which takes the detected bounding box as an input. Unlike object detection,
            object tracking uses the previous frame to estimate the change in pixels over time. This allows it to continue to track a 
            detected person, without needing to expend the computational energy to re-detect the subject every frame. As a result,
            performance is greatly increased.
          </p> 
        </div>
      </div>
    </div>

    <div class="overview">
      <h4>Stepper Motors</h4>
      <br>
      <div class="row">
        <div class="col">
          <img src="assets/final_prod_assets/hor_stepper.jpg" style="width: 100%">
        </div>
        <div class="col">
          <img src="assets/final_prod_assets/vert_stepper.jpg" style="width: 100%">
        </div>
        <div class="col-5">
          <p>
            The system used two stepper motors to horizontally pan and vertically tilt the camera towards the detected person. 
            The panning stepper is shown in the leftmost image-- it sits in the box under the tripod head and when the stepper rotates,
            the gears attached spin the tripod head containing the camera with it. The tilting stepper is pictured in the second photo, 
            where it is attached to a gear that moves the camera up and down. Both steppers are driven by A4988 Drivers and a CNC Motorshield
            mounted on top of an Arduino UNO R3 with our LiPo battery supplying power.
          </p> 
        </div>
      </div>
    </div>

    <div class="overview">
      <h4>Raspberry Pi</h4>
      <br>
      <div class="row">
        <div class="col">
          <img src="assets/final_prod_assets/rasp_pi.jpg" style="width: 100%">
        </div>
        <div class="col">
          <img src="assets/final_prod_assets/picamera.jpg" style="width: 100%">
        </div>
        <div class="col-5">
          <p>
            The Raspberry Pi was loaded with a program to track people's bodies and send commands to the Arduino via Serial communication
            through a USB cable. We mounted the Pi to the side of the tripod and 
            powered it with a battery pack, and attached the Picamera near the top of the tripod head.
          </p> 
        </div>
      </div>
    </div>

    <div class="overview">
      <h4>RC Motor and ESC</h4>
      <br>
      <div class="row">
        <div class="col">
          <img src="assets/final_prod_assets/esc_rc_motor.jpg" style="width: 100%">
        </div>
        <div class="col-7">
          <p>
            One of our stretch goals was to have the tripod drive on its own to physically follow a person as well. We used an RC Motor 
            and a corresponding Electronic Stability Controller (ESC), using a separate Arduino to send motor commands to it. However,
            due to time limitations we were not able to integrate properly with the rest of the system. If you want to learn more details
            about electrical progress with the RC Motor, look into the Sprint 3 page.
          </p> 
        </div>
      </div>
    </div>
  
    <div class="container sec-title">
      <div class="card mx-auto img-fluid section-card" style="background-color: gray;">
          <h1 class="card-text" style="color:white; font-size: 50px;">Firmware Design</h1>
      </div>
    </div>

    <div class="overview">
      <h4>Stepper Motor Logic</h4>
      <br>
      <div style="text-align: center;">
        <img src="assets/final_prod_assets/firmware_block_diagram.png" style="width: 60%;">
      </div>
      <br>
      <p>
        For the full firmware code, see the stepper_pan_tilt folder in our <a href="https://github.com/redhotchili0909/cam-track">GitHub Repo.</a>
      </p>
      <p>
        Using our Arduino UNO R3, we sent commands to the x and y stepper motors to move the camera according to commands from the Raspberry
        Pi tracking program. We start by reading the x and y coordinate sent through Serial communication from the Pi-- based on the sign and
        value of the coordinates, we determine the direction and number of steps each motor must take. The number of steps is also reduced
        by a <i>signDividend</i> for each motor-- this value comes from tuning and makes sure the steppers move the appropriate amount and 
        aren't stuck in a loop rotating and unable to read new Pi commands.
      </p>
      <p>
        The actual driving loop uses the maximum steps between x and y steps as a counter-- this enables us to move x and y motors in the same
        loop so the camera can pan and tilt at the same time. The process of stepping once involves sending a high pulse for a short amount of time,
        followed by a low pulse. Repeating this some number of times produces the same number of steps.  
      </p>
      <p>
        After the driving loop is done, the steppers are set low and go back to waiting for new Pi commands.
      </p>
    </div>

    <br>
    <br>
    <br>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>
</html>